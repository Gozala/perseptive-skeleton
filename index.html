<!DOCTYPE html>

<html>
  <head>
    <link rel="stylesheet" href="main.css">
    <meta charset='utf8'>
  </head>
  <body class='mode-show-webview'>

    <div class='webview-stack'>

      <div class='webview webview-selected'>
        <iframe mozbrowser class='webview-iframe' src='http://paulrouget.com'></iframe>
        <!-- topbar comes next. It can cover the iframe -->
        <div class='webview-local-overlay'></div>
        <div class='webview-topbar'>
          <!-- Why not one single global topbar?
            . doesn't require to udpate topbar/urlbar on tab switch
            . in the overview mode, views fade in and out, so 2 views
              and their topbars can be visible at the same time
          -->
          <div class='webview-topbar-background'></div>
          <div class='webview-combobar'>

            <div class='webview-title-container'>
              <!-- it's important that the 2 inline elements are not separated
              by a new line to avoid the 4px ghost margins -->
              <span class='webview-security-icon'>L</span><span class='webview-title'>Paul Rouget Blog</span>
            </div>

            <input class='webview-url-input' value='http://paulrouget.com/foo/bar.html' type='text'>

          </div>

          <div class='webview-show-sidebar-button'></div>
        </div>
      </div>

      <div class='webview'> <!-- a clone of the other webview, without the selected class -->
        <iframe mozbrowser class='webview-iframe' src='http://paulrouget.com/e/simpsons/'></iframe>
        <div class='webview-local-overlay'></div>
        <div class='webview-topbar'>
          <div class='webview-topbar-background'></div>
          <div class='webview-combobar'>
            <div class='webview-title-container'>
              <span class='webview-security-icon'>U</span><span class='webview-title'>GitHub</span>
            </div>
            <input class='webview-url-input' value='https://github.com/foobar.html' type='text'>
          </div>
          <div class='webview-show-sidebar-button'></div>
        </div>
      </div>

    </div>

    <div class='global-overlay'></div>

    <div class='sidebar'>

      <div class='sidebar-tabs-scrollbox'>
        <div class='sidebar-tab'><img class='sidebar-tab-smallicon' src='assets/favicon1.png'><div class='sidebar-tab-title'>A Bicyclops Built For Two</div></div>
        <div class='sidebar-tab'><img class='sidebar-tab-smallicon' src='assets/favicon2.png'><div class='sidebar-tab-title'>Love and Rocket</div></div>
        <div class='sidebar-tab sidebar-tab-selected'><img class='sidebar-tab-smallicon' src='assets/favicon3.png'><div class='sidebar-tab-title'>A Clone of My Own</div></div>
        <div class='sidebar-tab'><img class='sidebar-tab-smallicon' src='assets/favicon1.png'><div class='sidebar-tab-title'>Crimes of the Hot</div></div>
      </div>

      <div class='sidebar-toolbar'>
        <div class='sidebar-toolbar-left-buttons'>
          <div class='sidebar-toolbar-button sidebar-toolbar-pin-button'></div>
        </div>
        <div class='sidebar-toolbar-right-buttons'>
          <div class='sidebar-toolbar-button sidebar-toolbar-plus-button'></div>
        </div>
      </div>

    </div>

    <!-- ignore -->
    <div style='position: absolute; bottom: 20px; left: 20px'>
      <button onclick='mode("show-webview")'>show-webview</button>
      <button onclick='mode("show-tabs")'>show-tabs</button>
      <button onclick='mode("select-webview")'>select-webview</button>
      <button onclick='mode("edit-webview")'>edit-webview</button>
      <button onclick='mode("create-webview")'>create-webview</button>

      <!-- animation library -->
      <script src="https://rawgithub.com/lvivski/anima/master/anima.min.js"></script>

      <script>

        function mode(m) {
          modeJS(m);
        }

        function modeCSS(m) {
          document.body.className = 'mode-' + m;
          if (m == 'select-webview') {
            setTimeout(() => {
              var a = document.querySelector('.webview.webview-selected')
              var b = document.querySelector('.webview:not(.webview-selected)')
              a.classList.toggle('webview-selected');
              b.classList.toggle('webview-selected');
            }, 500);
          }
        }


        var world = anima.world();

        var animItems = {
          globalOverlay: world.add(document.querySelector('.global-overlay')),
          webviewLocalOverLay: world.add(document.querySelector('.webview-local-overlay')),
          webviewStack: world.add(document.querySelector('.webview-stack')),
          webview: world.add(document.querySelector('.webview')),
          webviewTopbarBackground: world.add(document.querySelector('.webview-topbar-background')),
          webviewCombobar: world.add(document.querySelector('.webview-combobar')),
          webviewTitleContainer: world.add(document.querySelector('.webview-title-container')),
          webviewUrlInput: world.add(document.querySelector('.webview-url-input')),
          sidebar: world.add(document.querySelector('.sidebar')),
          sidebarToolbarButton: world.add(document.querySelector('.sidebar-toolbar-button')),
        }

        var initialValues = {
            sidebarTranslate: 0,
            webviewStackTranslate: 0,
            webviewCombobarTransform: 0,
            webviewTitleContainerTranslate: 0,
            globalOverlayOpacity: 0,
            webviewLocalOverLayOpacity: 0,
            webviewTitleContainerOpacity: 1,
            webviewUrlInputOpacity: 0,
        }

        var currentValues = Object.create(initialValues);

        function modeJS(m) {

          var newValues = Object.create(initialValues);

          switch (m) {
            case 'show-tabs':
              newValues.globalOverlayOpacity = 1;
              newValues.sidebarTranslate = -560;
              newValues.webviewStackTranslate = -600;
              break;
            default:
              break;
          }

          var d;

          d = newValues.globalOverlayOpacity;
          animItems.globalOverlay.animate({ opacity: d }, 400);

          d = newValues.webviewLocalOverLayOpacity;
          animItems.webviewLocalOverLay.animate({ opacity: d }, 400);

          d = newValues.webviewStackTranslate - currentValues.webviewStackTranslate;
          animItems.webviewStack.animate({ translate: [0, 0, d] }, 400);

          d = newValues.sidebarTranslate - currentValues.sidebarTranslate;
          animItems.sidebar.animate({ translate: [d, 0, 0]}, 400);

          d = newValues.webviewCombobarTransform - currentValues.webviewCombobarTransform;
          animItems.webviewCombobar.animate({ transform: [0, d, 0] }, 400);

          d = newValues.webviewUrlInputOpacity;
          animItems.webviewUrlInput.animate({ opacity: d}, 400);

          d = newValues.webviewTitleContainerOpacity;
          animItems.webviewTitleContainer.animate({ opacity: d }, 400);

          currentValues = Object.create(newValues);

        }

        /*

          show-webview

          create-webview

          show-tabs
            globalOverlay: opacity
            sidebar: translate
            webviewStack: translate

          edit-webview
            webviewLocalOverLay: opacity
            webviewTitleContainer: transform
            webviewCombobar: transform
            webviewTitleContainer: opacity
            webviewUrlInput: opacity

           select-webview
            webviewStack: transform3d:-600px


         */


        function modeShowTabs(fwd) {
          animItems.sidebar.animate({
            translate: fwd ? [-560,0,0] : [0,0,0],
            duration: 400,
            ease: 'ease-in-out-quad'
          });
          animItems.globalOverlay.animate({
            opacity: fwd ? 1 : 0,
            duration: 400,
            ease: 'ease-in-out-quad'
          });
        }

      </script>
    </div>

  </body>
</html>
